<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../dig-common/dig-common.html">

<!--
An element which builds an elasticjs filter based on the set attributes.

Example:

        <elastic-client-filter-builder
            type: "terms"
            field: "field"
            values: "values"
            ejs-filter: "{{ejsFilter}}">
        </elastic-client-filter-builder>

@demo demo/index.html
-->

<dom-module id="elastic-client-filter-builder">
    <template>
    </template>

    <script>
        (function() {
            Polymer({
                is: 'elastic-client-filter-builder',

                properties: {
                    /**
                     * The field for the filter.
                    */
                    field: {
                        type: String
                    },

                    /**
                     * The values for the filter.
                     */
                    values: {
                        type: Array
                    },

                    /**
                     * Whether to build a 'not' filter.
                     */
                    not: {
                        type: Boolean,
                        value: false
                    },

                    /**
                     * The type of filter to build.
                     * Supported types:
                     * term, terms
                     */
                    type: {
                        type: String
                    },

                    /**
                     * The built elasticjs filter.
                     */
                    ejsFilter: {
                        type: Object,
                        readOnly: true,
                        notify: true
                    }
                },

                observers : [
                    'buildFilter(not, type, field, values)'
                ],

                buildFilter: function(not, type, field, values) {
                    var ejsFilter;
                    if(!values || (values.constructor === Array && !values.length)) {
                        this._setEjsFilter(null);
                    }
                    else if(type === 'term') {
                        var term = (values.constructor === Array && values.length === 1) ? values[0] : values;
                        ejsFilter = ejs.TermFilter(field, term);
                    }
                    else if(type === 'terms') {
                        var terms = (values.constructor === Array && values.length === 1) ? values[0] : values;
                        ejsFilter = ejs.TermsFilter(field, terms);
                    }
                    if(ejsFilter) {
                        if(not) {
                            ejsFilter = ejs.NotFilter(ejsFilter);
                        }
                        this._setEjsFilter(ejsFilter);
                    }
                }
            });
        })();
    </script>
</dom-module>
