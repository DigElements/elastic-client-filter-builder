<!doctype html>

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

        <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
        <script src="../../web-component-tester/browser.js"></script>

        <link rel="import" href="../elastic-client-filter-builder.html">
    </head>
    <body>
        <test-fixture id="elastic-client-filter-builder-fixture">
            <template>
                <elastic-client-filter-builder>
                </elastic-client-filter-builder>
            </template>
        </test-fixture>

        <script>
            suite('<elastic-client-filter-builder> for term filter', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'term';
                    component.field = 'testField';
                    component.values = 'testValue';
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.not).to.be.false;
                    expect(component.name).to.equal('');
                    expect(component.type).to.equal('term');
                    expect(component.field).to.equal('testField');
                    expect(component.values).to.equal('testValue');
                });

                test('term filter is built correctly', function() {
                    expect(component.ejsFilter).to.exist;
                    expect(component.ejsFilter.toJSON()).to.deep.equal(ejs.TermFilter('testField', 'testValue').toJSON());
                });
            });

            suite('<elastic-client-filter-builder> for term filter with name', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'term';
                    component.name = 'testName';
                    component.field = 'testField';
                    component.values = 'testValue';
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.not).to.be.false;
                    expect(component.name).to.equal('testName');
                    expect(component.type).to.equal('term');
                    expect(component.field).to.equal('testField');
                    expect(component.values).to.equal('testValue');
                });

                test('term filter is built correctly', function() {
                    expect(component.ejsFilter).to.exist;
                    expect(component.ejsFilter.toJSON()).to.deep.equal(ejs.TermFilter('testField', 'testValue').name('testName').toJSON());
                });
            });

            suite('<elastic-client-filter-builder> for not term filter', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.not = true;
                    component.type = 'term';
                    component.field = 'testField';
                    component.values = 'testValue';
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.not).to.be.true;
                    expect(component.name).to.equal('');
                    expect(component.type).to.equal('term');
                    expect(component.field).to.equal('testField');
                    expect(component.values).to.equal('testValue');
                });

                test('term filter is built correctly', function() {
                    expect(component.ejsFilter).to.exist;
                    expect(component.ejsFilter.toJSON()).to.deep.equal(ejs.NotFilter(ejs.TermFilter('testField', 'testValue')).toJSON());
                });
            });

            suite('<elastic-client-filter-builder> for terms filter', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'terms';
                    component.field = 'testField';
                    component.values = 'testValue';
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.not).to.be.false;
                    expect(component.name).to.equal('');
                    expect(component.type).to.equal('terms');
                    expect(component.field).to.equal('testField');
                    expect(component.values).to.equal('testValue');
                });

                test('terms filter is built correctly', function() {
                    expect(component.ejsFilter).to.exist;
                    expect(component.ejsFilter.toJSON()).to.deep.equal(ejs.TermsFilter('testField', 'testValue').toJSON());
                });
            });

            suite('<elastic-client-filter-builder> for terms filter array', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'terms';
                    component.field = 'testField';
                    component.values = ['testValue1', 'testValue2'];
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.type).to.equal('terms');
                    expect(component.field).to.equal('testField');
                    expect(component.values).to.be.an('Array');
                    expect(component.values).to.deep.equal(['testValue1', 'testValue2']);
                });

                test('terms filter is built correctly', function() {
                    expect(component.ejsFilter).to.exist;
                    expect(component.ejsFilter.toJSON()).to.deep.equal(ejs.TermsFilter('testField', ['testValue1', 'testValue2']).toJSON());
                });
            });

            suite('<elastic-client-filter-builder> for terms filter with one value', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'terms';
                    component.field = 'testField';
                    component.values = ['testValue'];
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.type).to.equal('terms');
                    expect(component.field).to.equal('testField');
                    expect(component.values).to.be.an('Array');
                    expect(component.values).to.deep.equal(['testValue']);
                });

                test('terms filter is built correctly', function() {
                    expect(component.ejsFilter).to.exist;
                    expect(component.ejsFilter.toJSON()).to.deep.equal(ejs.TermsFilter('testField', 'testValue').toJSON());
                });
            });

            suite('<elastic-client-filter-builder> for and filter', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'and';
                    component.field = null;
                    component.values = [ejs.TermFilter('testField1', 'testValue1'), ejs.TermFilter('testField2', 'testValue2')];
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.type).to.equal('and');
                    expect(component.field).to.be.null;
                    expect(component.values).to.be.an('Array');
                    expect(component.values.length).to.equal(2);
                    expect(component.values[0].toJSON()).to.deep.equal(ejs.TermFilter('testField1', 'testValue1').toJSON());
                    expect(component.values[1].toJSON()).to.deep.equal(ejs.TermFilter('testField2', 'testValue2').toJSON());
                });

                test('and filter is built correctly', function() {
                    expect(component.ejsFilter).to.exist;
                    expect(component.ejsFilter.toJSON()).to.deep.equal(ejs.AndFilter([ejs.TermFilter('testField1', 'testValue1'), ejs.TermFilter('testField2', 'testValue2')]).toJSON());
                });
            });

            suite('<elastic-client-filter-builder> for or filter', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'or';
                    component.field = null;
                    component.values = [ejs.TermFilter('testField1', 'testValue1'), ejs.TermFilter('testField2', 'testValue2')];
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.type).to.equal('or');
                    expect(component.field).to.be.null;
                    expect(component.values).to.be.an('Array');
                    expect(component.values.length).to.equal(2);
                    expect(component.values[0].toJSON()).to.deep.equal(ejs.TermFilter('testField1', 'testValue1').toJSON());
                    expect(component.values[1].toJSON()).to.deep.equal(ejs.TermFilter('testField2', 'testValue2').toJSON());
                });

                test('or filter is built correctly', function() {
                    expect(component.ejsFilter).to.exist;
                    expect(component.ejsFilter.toJSON()).to.deep.equal(ejs.OrFilter([ejs.TermFilter('testField1', 'testValue1'), ejs.TermFilter('testField2', 'testValue2')]).toJSON());
                });
            });

            suite('<elastic-client-filter-builder> for range filter', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'range';
                    component.field = 'testField';
                    component.values = ['testValue1', 'testValue2'];
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.type).to.equal('range');
                    expect(component.field).to.equal('testField');
                    expect(component.values).to.deep.equal(['testValue1', 'testValue2']);
                });

                test('range filter is built correctly', function() {
                    expect(component.ejsFilter).to.exist;
                    expect(component.ejsFilter.toJSON()).to.deep.equal(ejs.RangeFilter('testField').lte('testValue1').gte('testValue2').toJSON());
                });
            });

            suite('<elastic-client-filter-builder> for exists filter', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'exists';
                    component.field = 'testField';
                    component.values = null;
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.type).to.equal('exists');
                    expect(component.field).to.equal('testField');
                    expect(component.values).to.be.null;
                });

                test('range filter is built correctly', function() {
                    expect(component.ejsFilter).to.exist;
                    expect(component.ejsFilter.toJSON()).to.deep.equal(ejs.ExistsFilter('testField').toJSON());
                });
            });

            suite('<elastic-client-filter-builder> for blank values', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'term';
                    component.field = 'testField';
                    component.values = '';
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.type).to.equal('term');
                    expect(component.field).to.equal('testField');
                    expect(component.values).to.equal('');
                });

                test('filter is not built', function() {
                    expect(component.ejsFilter).to.be.null;
                });
            });

            suite('<elastic-client-filter-builder> for empty values array', function() {
                var component;

                setup(function(done) {
                    component = fixture('elastic-client-filter-builder-fixture');
                    component.type = 'term';
                    component.field = 'testField';
                    component.values = [];
                    flush(function() {
                      done();
                    });
                });

                test('properties are set correctly', function() {
                    expect(component.type).to.equal('term');
                    expect(component.field).to.equal('testField');
                    expect(component.values).to.deep.equal([]);
                });

                test('filter is not built', function() {
                    expect(component.ejsFilter).to.be.null;
                });
            });
        </script>
    </body>
</html>
